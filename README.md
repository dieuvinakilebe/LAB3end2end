# LAB3end2end

## Лабораторная работа №3  
### End-to-end тестирование

#### Цель работы
Освоить подход к end-to-end (E2E) тестированию, когда проверяется работа всей системы целиком с точки зрения внешнего пользователя — через HTTP-интерфейс. Научиться выделять ключевые пользовательские сценарии и автоматизировать их проверку.

---

### 1. Описание проекта

В качестве тестируемой системы выбран тот же проект, что и в ЛР2:

**FastAPI CRUD Todo** — REST API для управления задачами (todo):

- `POST /todos` — создание задачи;
- `GET /todos` — получение списка задач;
- `GET /todos/{id}` — получение задачи по идентификатору;
- `PUT /todos/{id}` — обновление задачи;
- `DELETE /todos/{id}` — удаление задачи.

Хранение данных реализовано через SQLite и SQLAlchemy.

В рамках данной лабораторной работа система рассматривается как «чёрный ящик»: доступ к функционалу осуществляется только через HTTP-запросы.

---

### 2. Пользовательские сценарии (user flows)

Были выделены следующие ключевые сценарии:

1. **Полный жизненный цикл задачи**
   - Пользователь создаёт новую задачу.
   - Ожидает, что задача появится в списке задач.
   - Может просмотреть детальную информацию по задаче.
   - Может изменить параметры задачи.
   - Может удалить задачу.
   - После удаления задача становится недоступной (возвращается 404).

   Это критический сценарий, так как отражает основную бизнес-функцию системы — управление задачами.

2. **Обработка ошибок и некорректных действий**
   - Попытка создать задачу с некорректными данными (например, без обязательного поля `title`).
   - Попытка получить или обновить несуществующую задачу (ожидание 404 или соответствующей ошибки).

   Сценарий важен, так как показывает поведение системы в условиях некорректного ввода и возможных пользовательских ошибок.

---

### 3. Инструменты E2E-тестирования

Для E2E-тестирования использовались:

- `pytest` — фреймворк для запуска тестов;
- библиотека `requests` — для отправки HTTP-запросов к запущенному FastAPI-приложению.

В данной работе API выступает в роли пользовательского интерфейса для внешних клиентов (других сервисов или frontend-части), поэтому тесты на уровне HTTP рассматриваются как end-to-end: они проходят весь путь данных от клиента до базы и обратно, без прямого доступа к внутренним объектам приложения.

---

### 4. Реализованные E2E-тесты

Файл: `tests/test_e2e_todos_api.py`.

#### 4.1. `test_e2e_create_read_update_delete_todo`

Проверяет полный путь:

1. **Создание задачи** (`POST /todos`):
   - Отправка валидного JSON.
   - Проверка кода ответа (200/201).
   - Сохранение `id` созданной задачи.

2. **Получение списка задач** (`GET /todos`):
   - Проверка кода ответа 200.
   - Поиск созданной задачи в списке по `id`.

3. **Получение задачи по id** (`GET /todos/{id}`):
   - Проверка кода ответа 200.
   - Сверка полей `title` и `description` с исходными данными.

4. **Обновление задачи** (`PUT /todos/{id}`):
   - Изменение `title` и `description`.
   - Проверка кода ответа 200.
   - Проверка, что изменения отражены в ответе.

5. **Удаление задачи** (`DELETE /todos/{id}`):
   - Проверка кода ответа (200/204).

6. **Проверка 404 после удаления** (`GET /todos/{id}`):
   - Ожидаемый код 404 — задача больше не существует.

Этот тест подтверждает, что основной пользовательский сценарий (CRUD для задач) работает корректно end-to-end.

#### 4.2. `test_e2e_validation_and_errors`

Проверяет негативные сценарии:

1. **Попытка создания задачи без обязательного поля `title`**:
   - Ожидается код ответа 422 и наличие поля `detail` в теле ответа.

2. **Получение несуществующей задачи**:
   - Запрос к `GET /todos/999999`.
   - Ожидается 404.

3. **Обновление несуществующей задачи**:
   - Запрос к `PUT /todos/999999`.
   - Ожидается одна из ошибок (404 или 400) в зависимости от реализации.

Тест подтверждает, что система корректно обрабатывает некорректные запросы и не выдаёт успешные ответы там, где ресурс не существует.

---

### 5. Результаты выполнения тестов

При запущенном приложении (`uvicorn main:app --reload`) и запуске:

```bash
pytest tests/test_e2e_todos_api.py -vv
